---
name: "Memory Sync"
description: "Синхронизация agency-memory с GitHub (pull, commit, push) в один клик"
alwaysAllow: ["Bash"]
---

# Memory Sync - Git синхронизация Agency Memory

Автоматическая синхронизация локальной долгосрочной памяти с GitHub репозиторием.

## Что делает этот Skill

Выполняет полный цикл Git синхронизации:
1. **Pull** - получает последние изменения из GitHub
2. **Add** - добавляет все новые и измененные файлы
3. **Commit** - создает коммит с меткой craft-agents
4. **Push** - отправляет изменения в GitHub

## Процесс синхронизации

### Шаг 1: Проверить статус репозитория

```bash
cd d:/projects/ai-lab/agency-memory
git status
```

Покажи пользователю:
- Измененные файлы
- Неотслеживаемые файлы
- Текущую ветку
- Статус синхронизации с remote

### Шаг 2: Pull последних изменений

```bash
git pull origin main
```

**Важно:**
- Если есть конфликты, сообщи пользователю и попроси разрешить их вручную
- Если pull чистый, продолжай дальше

### Шаг 3: Add все изменения

```bash
git add .
```

**Проверки:**
- ✅ Убедись, что добавляются только `.md` файлы и конфигурация
- ⚠️ Предупреди, если добавляются `.env` или другие секретные файлы
- ⚠️ Предупреди, если добавляются большие файлы (>1MB)

### Шаг 4: Commit с правильным сообщением

```bash
git commit -m "sync: $(date +%Y-%m-%d) - craft-agents

Co-Authored-By: WS Workspace <noreply@wsagency.dev>"
```

**Формат сообщения:**
```
sync: 2026-02-15 - craft-agents

Co-Authored-By: WS Workspace <noreply@wsagency.dev>
```

### Шаг 5: Push в GitHub

```bash
git push origin main
```

**Обработка ошибок:**
- Если push rejected → выполни `git pull --rebase` и попробуй снова
- Если нет прав → сообщи пользователю проверить SSH ключи

### Шаг 6: Подтверждение

Покажи пользователю результат:

```
✅ Синхронизация завершена

Коммит: sync: 2026-02-15 - craft-agents
Файлов изменено: 3
Добавлено: 2 заметки
Обновлено: 1 заметка

GitHub: https://github.com/username/agency-memory/commits/main
```

## Умная синхронизация

### Автоматическое определение изменений

Если `git status` показывает:
- **Нет изменений** → сообщи "Все уже синхронизировано ✅"
- **Только локальные коммиты** → выполни только `push`
- **Только remote изменения** → выполни только `pull`
- **И локальные, и remote** → выполни полный цикл

### Группировка изменений в commit message

Если добавлено несколько заметок, перечисли их:

```
sync: 2026-02-15 - craft-agents

Добавлено:
- insight-playwright-test-healing.md
- decision-sanity-over-strapi.md

Обновлено:
- best-practice-git-commit-messages.md

Co-Authored-By: WS Workspace <noreply@wsagency.dev>
```

## Режимы работы

### Режим 1: Стандартная синхронизация
```
/memory-sync
```
Выполняет полный цикл: pull → add → commit → push

### Режим 2: Только pull
```
/memory-sync --pull
```
Только получает изменения из GitHub

### Режим 3: Только push
```
/memory-sync --push
```
Только отправляет локальные изменения (если уже есть коммит)

### Режим 4: Dry run
```
/memory-sync --dry-run
```
Показывает, что будет сделано, но не выполняет

## Безопасность

### Проверки перед commit

- ❌ НЕ коммить файлы с секретами (.env, credentials.json)
- ❌ НЕ коммить большие бинарные файлы
- ❌ НЕ коммить временные файлы (.tmp, .log)

Если обнаружены такие файлы:
```
⚠️ Обнаружены файлы, которые не должны быть в Git:
- .env (содержит секреты)
- large-file.zip (>10MB)

Исключить их из коммита? [Да/Нет]
```

### Git hooks

Если настроены pre-commit hooks, позволь им выполниться.
Если hook failed → покажи ошибку и попроси пользователя исправить.

## Обработка ошибок

### Ошибка: "Please commit your changes or stash them"
```
У вас есть незакоммиченные изменения.
Создать коммит перед pull? [Да/Нет]
```

### Ошибка: "Merge conflict"
```
⚠️ Конфликт при слиянии в файлах:
- memory-exports/insights/insight-name.md

Разрешите конфликты вручную и запустите /memory-sync снова.

Открыть файл с конфликтом? [Да/Нет]
```

### Ошибка: "Authentication failed"
```
❌ Не удалось подключиться к GitHub.
Проверьте SSH ключи или HTTPS токен.

Подсказка: gh auth status
```

## После успешной синхронизации

Предложи пользователю:
1. Посмотреть коммит на GitHub
2. Создать новую заметку (`/memory-write`)
3. Искать в заметках (`/memory-search`)

## Что НЕ делать

❌ НЕ используй `git add -A` без проверки
❌ НЕ делай force push (`git push -f`)
❌ НЕ коммить без сообщения
❌ НЕ пропускай co-author метку
❌ НЕ синхронизируй, если репозиторий не инициализирован
